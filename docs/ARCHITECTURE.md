# Mentis - Architecture Documentation

> Notion ìŠ¤íƒ€ì¼ì˜ ì‹¤ì‹œê°„ í˜‘ì—… ë¬¸ì„œ í¸ì§‘ê¸°

## ëª©ì°¨

- [í”„ë¡œì íŠ¸ ê°œìš”](#í”„ë¡œì íŠ¸-ê°œìš”)
- [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
- [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
- [ë””ë ‰í† ë¦¬ êµ¬ì¡°](#ë””ë ‰í† ë¦¬-êµ¬ì¡°)
- [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ](#ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ)
- [ì¸ì¦ ì‹œìŠ¤í…œ](#ì¸ì¦-ì‹œìŠ¤í…œ)
- [API ë¼ìš°íŠ¸](#api-ë¼ìš°íŠ¸)
- [ìƒíƒœ ê´€ë¦¬](#ìƒíƒœ-ê´€ë¦¬)
- [ì‹¤ì‹œê°„ í˜‘ì—…](#ì‹¤ì‹œê°„-í˜‘ì—…)
- [ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜](#ì»´í¬ë„ŒíŠ¸-ì•„í‚¤í…ì²˜)
- [ìŠ¤íƒ€ì¼ë§ ì‹œìŠ¤í…œ](#ìŠ¤íƒ€ì¼ë§-ì‹œìŠ¤í…œ)
- [ë°°í¬ êµ¬ì„±](#ë°°í¬-êµ¬ì„±)

---

## í”„ë¡œì íŠ¸ ê°œìš”

MentisëŠ” Next.js 14 App Router ê¸°ë°˜ì˜ Notion í´ë¡  í”„ë¡œì íŠ¸ë¡œ, ì‹¤ì‹œê°„ í˜‘ì—… í¸ì§‘, ê³„ì¸µí˜• ë¬¸ì„œ ê´€ë¦¬, ë¬¸ì„œ í¼ë¸”ë¦¬ì‹± ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. Seed Design System(ë‹¹ê·¼ ë””ìì¸ ì‹œìŠ¤í…œ)ì„ ì ìš©í•˜ì—¬ ì¼ê´€ëœ UIë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.

### í•µì‹¬ ê¸°ëŠ¥

| ê¸°ëŠ¥ | ì„¤ëª… |
|------|------|
| **ê³„ì¸µí˜• ë¬¸ì„œ** | ë¶€ëª¨-ìì‹ ê´€ê³„ì˜ íŠ¸ë¦¬ êµ¬ì¡° ë¬¸ì„œ ê´€ë¦¬ |
| **ì‹¤ì‹œê°„ í˜‘ì—…** | BlockNote + Yjs ê¸°ë°˜ ë™ì‹œ í¸ì§‘ ë° ì ‘ì†ì í‘œì‹œ |
| **ë¦¬ì¹˜ ì—ë””í„°** | íŒŒì¼ ì—…ë¡œë“œ, ì»¤ë²„ ì´ë¯¸ì§€, ì´ëª¨ì§€ ì•„ì´ì½˜ ì§€ì› |
| **ë¬¸ì„œ í¼ë¸”ë¦¬ì‹±** | ê³µê°œ URLì„ í†µí•œ ë¬¸ì„œ ê³µìœ  |
| **ì¸ì¦** | ìì²´ ì¸ì¦ + Okta SSO (ì„ íƒì ) |
| **ë‹¤í¬ ëª¨ë“œ** | next-themes ê¸°ë°˜ í…Œë§ˆ ì „í™˜ |

---

## ê¸°ìˆ  ìŠ¤íƒ

### Frontend

| ê¸°ìˆ  | ë²„ì „ | ì—­í•  |
|------|------|------|
| Next.js | 14.0.1 | App Router, SSR, API Routes |
| React | 18.x | UI ë Œë”ë§ |
| TypeScript | 5.x | íƒ€ì… ì•ˆì „ì„± |
| Tailwind CSS | 3.3.0 | ìœ í‹¸ë¦¬í‹° ê¸°ë°˜ ìŠ¤íƒ€ì¼ë§ |
| Radix UI | - | ì ‘ê·¼ì„± ê¸°ë°˜ UI í”„ë¦¬ë¯¸í‹°ë¸Œ |
| shadcn/ui | - | ì‚¬ì „ ìŠ¤íƒ€ì¼ë§ëœ ì»´í¬ë„ŒíŠ¸ |
| BlockNote | 0.46.2 | ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° |
| Yjs | 13.6.29 | CRDT ê¸°ë°˜ ì‹¤ì‹œê°„ ë™ê¸°í™” |

### Backend / Data

| ê¸°ìˆ  | ë²„ì „ | ì—­í•  |
|------|------|------|
| PostgreSQL | 16 | ê¸°ë³¸ ë°ì´í„°ë² ì´ìŠ¤ |
| Drizzle ORM | 0.45.1 | íƒ€ì… ì•ˆì „ ì¿¼ë¦¬ ë¹Œë” |
| NextAuth | 5.0.0-beta.30 | JWT ì„¸ì…˜ ì¸ì¦ |
| y-websocket | 3.0.0 | Yjs WebSocket ì„œë²„ |

### ìƒíƒœ ê´€ë¦¬

| ê¸°ìˆ  | ë²„ì „ | ì—­í•  |
|------|------|------|
| TanStack React Query | 5.90.20 | ì„œë²„ ìƒíƒœ ê´€ë¦¬ (ìºì‹±, ë™ê¸°í™”) |
| Zustand | 4.4.6 | í´ë¼ì´ì–¸íŠ¸ UI ìƒíƒœ (ëª¨ë‹¬, ê²€ìƒ‰) |

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Client (Browser)                     â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ React UI â”‚  â”‚ React     â”‚  â”‚ BlockNote Editor     â”‚ â”‚
â”‚  â”‚ (Radix/  â”‚  â”‚ Query     â”‚  â”‚ + Yjs Provider       â”‚ â”‚
â”‚  â”‚  shadcn) â”‚  â”‚ (Server   â”‚  â”‚ (CRDT Sync)          â”‚ â”‚
â”‚  â”‚          â”‚  â”‚  State)   â”‚  â”‚                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚              â”‚                    â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Zustand (Client State) â”‚    â”‚ y-websocket Client â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ HTTP/REST         â”‚ WebSocket
                       â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Next.js API Routes         â”‚  â”‚  Yjs WebSocket   â”‚
â”‚   (Serverless Functions)     â”‚  â”‚  Server (:1234)  â”‚
â”‚                              â”‚  â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  Real-time doc   â”‚
â”‚  â”‚ NextAuth   â”‚ â”‚ Drizzle â”‚ â”‚  â”‚  synchronization â”‚
â”‚  â”‚ (JWT Auth) â”‚ â”‚ ORM     â”‚ â”‚  â”‚  + presence      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                      â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  PostgreSQL 16  â”‚
              â”‚                 â”‚
              â”‚  users          â”‚
              â”‚  documents      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„

1. **ë¬¸ì„œ CRUD**: Client â†’ React Query â†’ API Routes â†’ Drizzle ORM â†’ PostgreSQL
2. **ì‹¤ì‹œê°„ í¸ì§‘**: Client â†’ y-websocket â†’ Yjs WebSocket Server â†’ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ë¡œ ë¸Œë¡œë“œìºìŠ¤íŠ¸
3. **ì¸ì¦**: Client â†’ NextAuth â†’ JWT í† í° â†’ Middleware ê²€ì¦
4. **íŒŒì¼ ì—…ë¡œë“œ**: Client â†’ `/api/upload` â†’ ë¡œì»¬ íŒŒì¼ì‹œìŠ¤í…œ (`/public/uploads/`)

---

## ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
mentis/
â”œâ”€â”€ app/                              # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/                       # ì¸ì¦ í˜ì´ì§€ (ë¡œê·¸ì¸, íšŒì›ê°€ì…)
â”‚   â”‚   â”œâ”€â”€ layout.tsx               # ì¤‘ì•™ ì •ë ¬ ë ˆì´ì•„ì›ƒ
â”‚   â”‚   â”œâ”€â”€ login/page.tsx           # ë¡œê·¸ì¸ (Credentials + Okta)
â”‚   â”‚   â””â”€â”€ register/page.tsx        # íšŒì›ê°€ì…
â”‚   â”‚
â”‚   â”œâ”€â”€ (main)/                       # ì¸ì¦ í•„ìš” - ë©”ì¸ ì•±
â”‚   â”‚   â”œâ”€â”€ layout.tsx               # ì‚¬ì´ë“œë°” í¬í•¨ ë ˆì´ì•„ì›ƒ
â”‚   â”‚   â”œâ”€â”€ (routes)/documents/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx             # ë¬¸ì„œ ëª©ë¡ / ì›°ì»´
â”‚   â”‚   â”‚   â””â”€â”€ [documentId]/page.tsx # ë¬¸ì„œ ì—ë””í„°
â”‚   â”‚   â””â”€â”€ _components/             # ë©”ì¸ ë ˆì´ì•„ì›ƒ ì „ìš© ì»´í¬ë„ŒíŠ¸
â”‚   â”‚       â”œâ”€â”€ navigation.tsx       # ë¦¬ì‚¬ì´ì¦ˆ ê°€ëŠ¥ ì‚¬ì´ë“œë°”
â”‚   â”‚       â”œâ”€â”€ document-list.tsx    # ì¬ê·€ì  ë¬¸ì„œ íŠ¸ë¦¬
â”‚   â”‚       â”œâ”€â”€ search-command.tsx   # ì»¤ë§¨ë“œ íŒ”ë ˆíŠ¸ (âŒ˜+K)
â”‚   â”‚       â”œâ”€â”€ navbar.tsx           # ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°”
â”‚   â”‚       â”œâ”€â”€ collaborators.tsx    # ì‹¤ì‹œê°„ ì ‘ì†ì í‘œì‹œ
â”‚   â”‚       â”œâ”€â”€ publish.tsx          # í¼ë¸”ë¦¬ì‹œ ë‹¤ì´ì–¼ë¡œê·¸
â”‚   â”‚       â”œâ”€â”€ trash-box.tsx        # íœ´ì§€í†µ UI
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ (marketing)/                  # ê³µê°œ ëœë”© í˜ì´ì§€
â”‚   â”‚   â””â”€â”€ _components/             # íˆì–´ë¡œ, ë„¤ë¹„ë°”, í‘¸í„°
â”‚   â”‚
â”‚   â”œâ”€â”€ (public)/                     # ê³µê°œ ë¬¸ì„œ í”„ë¦¬ë·°
â”‚   â”‚   â””â”€â”€ (routes)/preview/[documentId]/page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                          # API ë¼ìš°íŠ¸
â”‚   â”‚   â”œâ”€â”€ auth/[...nextauth]/      # NextAuth í•¸ë“¤ëŸ¬
â”‚   â”‚   â”œâ”€â”€ register/                # íšŒì›ê°€ì… API
â”‚   â”‚   â”œâ”€â”€ documents/               # ë¬¸ì„œ CRUD API
â”‚   â”‚   â”œâ”€â”€ upload/                  # íŒŒì¼ ì—…ë¡œë“œ API
â”‚   â”‚   â””â”€â”€ uploads/[filename]/      # ì—…ë¡œë“œ íŒŒì¼ ì„œë¹™
â”‚   â”‚
â”‚   â”œâ”€â”€ layout.tsx                    # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ (í”„ë¡œë°”ì´ë”)
â”‚   â””â”€â”€ globals.css                   # ê¸€ë¡œë²Œ ìŠ¤íƒ€ì¼ + ë””ìì¸ í† í°
â”‚
â”œâ”€â”€ components/                       # ê³µìœ  ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ ui/                          # shadcn/Radix í”„ë¦¬ë¯¸í‹°ë¸Œ
â”‚   â”œâ”€â”€ modals/                      # ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ providers/                   # Context í”„ë¡œë°”ì´ë”
â”‚   â”œâ”€â”€ editor.tsx                   # BlockNote + Yjs ì—ë””í„°
â”‚   â”œâ”€â”€ toolbar.tsx                  # ë¬¸ì„œ í—¤ë” íˆ´ë°”
â”‚   â”œâ”€â”€ cover.tsx                    # ì»¤ë²„ ì´ë¯¸ì§€ ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ icon-picker.tsx              # ì´ëª¨ì§€ ì„ íƒê¸°
â”‚
â”œâ”€â”€ hooks/                            # ì»¤ìŠ¤í…€ React Hooks
â”‚   â”œâ”€â”€ use-documents.ts             # React Query ë¬¸ì„œ í›…
â”‚   â”œâ”€â”€ use-search.ts               # ê²€ìƒ‰ ëª¨ë‹¬ ìƒíƒœ (Zustand)
â”‚   â”œâ”€â”€ use-settings.ts             # ì„¤ì • ëª¨ë‹¬ ìƒíƒœ (Zustand)
â”‚   â”œâ”€â”€ use-cover-image.ts          # ì»¤ë²„ ì´ë¯¸ì§€ ëª¨ë‹¬ ìƒíƒœ
â”‚   â””â”€â”€ use-presence.ts             # Yjs ì ‘ì†ì ìƒíƒœ
â”‚
â”œâ”€â”€ lib/                              # ìœ í‹¸ë¦¬í‹° & ë¼ì´ë¸ŒëŸ¬ë¦¬
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ index.ts                 # DB ì—°ê²° (pg Pool + Drizzle)
â”‚   â”‚   â””â”€â”€ schema.ts               # í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì •ì˜
â”‚   â”œâ”€â”€ api.ts                       # API í´ë¼ì´ì–¸íŠ¸ ë˜í¼
â”‚   â””â”€â”€ utils.ts                     # cn() ìœ í‹¸ë¦¬í‹° (clsx + twMerge)
â”‚
â”œâ”€â”€ scripts/                          # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ yjs-server.cjs               # Yjs WebSocket ì„œë²„
â”‚   â””â”€â”€ migrate.ts                   # DB ë§ˆì´ê·¸ë ˆì´ì…˜
â”‚
â”œâ”€â”€ auth.ts                           # NextAuth ì¸ìŠ¤í„´ìŠ¤
â”œâ”€â”€ auth.config.ts                    # ì¸ì¦ ì„¤ì •
â”œâ”€â”€ middleware.ts                     # ë¼ìš°íŠ¸ ë³´í˜¸ ë¯¸ë“¤ì›¨ì–´
â”œâ”€â”€ drizzle.config.ts                 # Drizzle ORM ì„¤ì •
â”œâ”€â”€ docker-compose.yml                # Docker ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â”œâ”€â”€ Dockerfile                        # ì•± ì»¨í…Œì´ë„ˆ
â””â”€â”€ Dockerfile.yjs                    # Yjs ì„œë²„ ì»¨í…Œì´ë„ˆ
```

### Route Groups ì„¤ê³„

Next.js App Routerì˜ Route Group `(groupName)` íŒ¨í„´ì„ í™œìš©í•˜ì—¬ URL ê²½ë¡œì— ì˜í–¥ ì—†ì´ ë ˆì´ì•„ì›ƒì„ ë¶„ë¦¬í•©ë‹ˆë‹¤:

| Route Group | ë ˆì´ì•„ì›ƒ | ì ‘ê·¼ ê¶Œí•œ | ìš©ë„ |
|-------------|----------|----------|------|
| `(auth)` | ì¤‘ì•™ ì •ë ¬ | ê³µê°œ | ë¡œê·¸ì¸/íšŒì›ê°€ì… |
| `(main)` | ì‚¬ì´ë“œë°” + ë„¤ë¹„ë°” | ì¸ì¦ í•„ìš” | ë©”ì¸ ì•± |
| `(marketing)` | ë§ˆì¼€íŒ… ë ˆì´ì•„ì›ƒ | ê³µê°œ | ëœë”© í˜ì´ì§€ |
| `(public)` | ìµœì†Œ ë ˆì´ì•„ì›ƒ | ê³µê°œ | í¼ë¸”ë¦¬ì‹œëœ ë¬¸ì„œ í”„ë¦¬ë·° |

---

## ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### ERD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             users                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id           UUID     PK        â”‚
â”‚ name         TEXT     nullable   â”‚
â”‚ email        TEXT     UNIQUE     â”‚
â”‚ passwordHash TEXT     nullable   â”‚
â”‚ provider     TEXT     "credentials" â”‚
â”‚ providerId   TEXT     nullable   â”‚
â”‚ image        TEXT     nullable   â”‚
â”‚ createdAt    TIMESTAMP           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ userId (ë…¼ë¦¬ì  ì°¸ì¡°)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           documents              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id             UUID     PK      â”‚
â”‚ title          TEXT              â”‚
â”‚ userId         TEXT     indexed  â”‚
â”‚ isArchived     BOOLEAN  false    â”‚
â”‚ isPublished    BOOLEAN  false    â”‚
â”‚ parentDocument UUID     FK(self) â”‚ â”€â”€â” CASCADE DELETE
â”‚ content        TEXT     nullable â”‚   â”‚
â”‚ coverImage     TEXT     nullable â”‚   â”‚
â”‚ icon           TEXT     nullable â”‚   â”‚
â”‚ createdAt      TIMESTAMP         â”‚   â”‚
â”‚ updatedAt      TIMESTAMP         â”‚   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ IDX: user_id                     â”‚   â”‚
â”‚ IDX: user_id + parentDocument    â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â—„â”€â”˜
```

### ì£¼ìš” ì„¤ê³„ ê²°ì •

- **Self-referencing FK**: `parentDocument`ê°€ ê°™ì€ í…Œì´ë¸”ì˜ `id`ë¥¼ ì°¸ì¡°í•˜ì—¬ ë¬´í•œ ê¹Šì´ì˜ íŠ¸ë¦¬ êµ¬ì¡° ì§€ì›
- **CASCADE DELETE**: ë¶€ëª¨ ì‚­ì œ ì‹œ ìì‹ ë¬¸ì„œ ìë™ ì‚­ì œ
- **userId**: ì™¸ë˜ í‚¤ ì œì•½ ì¡°ê±´ ì—†ì´ ì¸ë±ìŠ¤ë§Œ ì ìš© (ìœ ì—°ì„±)
- **content**: BlockNote ì—ë””í„°ì˜ JSON ë¬¸ì„œë¥¼ TEXTë¡œ ì €ì¥

---

## ì¸ì¦ ì‹œìŠ¤í…œ

### ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Login UI   â”‚â”€â”€â”€â”€â–¶â”‚  NextAuth    â”‚â”€â”€â”€â”€â–¶â”‚  JWT Token      â”‚
â”‚             â”‚     â”‚  v5 (beta)   â”‚     â”‚  (Stateless)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
              â–¼                       â–¼           â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Credentials  â”‚      â”‚ Okta SSO     â”‚  â”‚Middlewareâ”‚
     â”‚ (bcryptjs)   â”‚      â”‚ (Optional)   â”‚  â”‚(Route    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ Guard)   â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì¸ì¦ í”Œë¡œìš°

1. **Credentials ë¡œê·¸ì¸**: ì´ë©”ì¼ + ë¹„ë°€ë²ˆí˜¸ â†’ bcrypt ê²€ì¦ â†’ JWT ë°œê¸‰
2. **Okta SSO** (ì„ íƒì ): OAuth í”Œë¡œìš° â†’ ìë™ ì‚¬ìš©ì ìƒì„±/ì¡°íšŒ â†’ JWT ë°œê¸‰
3. **ì„¸ì…˜ ê´€ë¦¬**: JWT ì „ëµ (ì„œë²„ ì‚¬ì´ë“œ ì„¸ì…˜ ì—†ìŒ)
4. **ë¼ìš°íŠ¸ ë³´í˜¸**: `middleware.ts`ì—ì„œ ê³µê°œ ê²½ë¡œ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ë°©ì‹

### ê³µê°œ ê²½ë¡œ

```
/                          # ëœë”© í˜ì´ì§€
/login, /register          # ì¸ì¦ í˜ì´ì§€
/api/auth/*                # NextAuth í•¸ë“¤ëŸ¬
/api/register              # íšŒì›ê°€ì… API
/api/documents/public/*    # í¼ë¸”ë¦¬ì‹œëœ ë¬¸ì„œ API
/preview/*                 # ë¬¸ì„œ í”„ë¦¬ë·°
```

---

## API ë¼ìš°íŠ¸

### ë¬¸ì„œ API

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì¸ì¦ | ì„¤ëª… |
|-----------|--------|------|------|
| `/api/documents` | `GET` | O | ë¬¸ì„œ ê²€ìƒ‰ (ì œëª© ê¸°ì¤€) |
| `/api/documents` | `POST` | O | ìƒˆ ë¬¸ì„œ ìƒì„± |
| `/api/documents/sidebar` | `GET` | O | ì‚¬ì´ë“œë°” íŠ¸ë¦¬ ì¡°íšŒ (ë¶€ëª¨ë³„ ìì‹) |
| `/api/documents/trash` | `GET` | O | íœ´ì§€í†µ ë¬¸ì„œ ëª©ë¡ |
| `/api/documents/public/[id]` | `GET` | X | í¼ë¸”ë¦¬ì‹œëœ ë¬¸ì„œ ì¡°íšŒ |
| `/api/documents/[id]` | `GET` | â–³ | ë¬¸ì„œ ì¡°íšŒ (í¼ë¸”ë¦¬ì‹œ ì‹œ ê³µê°œ) |
| `/api/documents/[id]` | `PATCH` | O | ë¬¸ì„œ ìˆ˜ì • (ì œëª©, ë‚´ìš©, ì»¤ë²„ ë“±) |
| `/api/documents/[id]` | `DELETE` | O | ë¬¸ì„œ ì˜êµ¬ ì‚­ì œ |
| `/api/documents/[id]/archive` | `PATCH` | O | ë¬¸ì„œ ì¬ê·€ì  ì•„ì¹´ì´ë¸Œ |
| `/api/documents/[id]/restore` | `PATCH` | O | ë¬¸ì„œ ì¬ê·€ì  ë³µì› |
| `/api/documents/[id]/icon` | `DELETE` | O | ì•„ì´ì½˜ ì œê±° |
| `/api/documents/[id]/cover` | `DELETE` | O | ì»¤ë²„ ì´ë¯¸ì§€ ì œê±° |

### íŒŒì¼ API

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì¸ì¦ | ì„¤ëª… |
|-----------|--------|------|------|
| `/api/upload` | `POST` | O | íŒŒì¼ ì—…ë¡œë“œ (UUID ì ‘ë‘ì‚¬) |
| `/api/upload` | `DELETE` | O | ì—…ë¡œë“œëœ íŒŒì¼ ì‚­ì œ |
| `/api/uploads/[filename]` | `GET` | X | ì—…ë¡œë“œ íŒŒì¼ ì„œë¹™ |

### ì¸ì¦ API

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì¸ì¦ | ì„¤ëª… |
|-----------|--------|------|------|
| `/api/auth/[...nextauth]` | `*` | X | NextAuth í•¸ë“¤ëŸ¬ |
| `/api/register` | `POST` | X | ì‹ ê·œ ì‚¬ìš©ì ë“±ë¡ |

### ë³´ì•ˆ ëª¨ë¸

- ëª¨ë“  ì¸ì¦ ì—”ë“œí¬ì¸íŠ¸ëŠ” `session.user.id`ë¡œ ì†Œìœ ê¶Œ ê²€ì¦
- ë¬¸ì„œ ìˆ˜ì •/ì‚­ì œ ì‹œ ì†Œìœ ì í™•ì¸ (`userId` ë§¤ì¹­)
- ê³µê°œ ë¬¸ì„œëŠ” `isPublished: true && isArchived: false` ì¡°ê±´ ì¶©ì¡± í•„ìš”
- íŒŒì¼ ì—…ë¡œë“œëŠ” UUID ì ‘ë‘ì‚¬ë¡œ íŒŒì¼ëª… ì¶©ëŒ ë°©ì§€

---

## ìƒíƒœ ê´€ë¦¬

### ê³„ì¸µ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ìƒíƒœ ê´€ë¦¬ ê³„ì¸µ                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     TanStack React Query (ì„œë²„ ìƒíƒœ)       â”‚  â”‚
â”‚  â”‚                                           â”‚  â”‚
â”‚  â”‚  â€¢ ë¬¸ì„œ CRUD ì¿¼ë¦¬ & ë®¤í…Œì´ì…˜               â”‚  â”‚
â”‚  â”‚  â€¢ ìë™ ìºì‹œ ë¬´íš¨í™”                        â”‚  â”‚
â”‚  â”‚  â€¢ staleTime: 60ì´ˆ                        â”‚  â”‚
â”‚  â”‚  â€¢ ìœˆë„ìš° í¬ì»¤ìŠ¤ ì‹œ ë¦¬í˜ì¹˜                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     Zustand (í´ë¼ì´ì–¸íŠ¸ UI ìƒíƒœ)            â”‚  â”‚
â”‚  â”‚                                           â”‚  â”‚
â”‚  â”‚  â€¢ useSearch: ê²€ìƒ‰ ëª¨ë‹¬ open/close         â”‚  â”‚
â”‚  â”‚  â€¢ useSettings: ì„¤ì • ëª¨ë‹¬ open/close       â”‚  â”‚
â”‚  â”‚  â€¢ useCoverImage: ì»¤ë²„ ì´ë¯¸ì§€ ëª¨ë‹¬          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     Yjs Awareness (ì‹¤ì‹œê°„ ìƒíƒœ)             â”‚  â”‚
â”‚  â”‚                                           â”‚  â”‚
â”‚  â”‚  â€¢ usePresence: í˜„ì¬ ì ‘ì†ì ì •ë³´            â”‚  â”‚
â”‚  â”‚  â€¢ ì‚¬ìš©ìë³„ ìƒ‰ìƒ, ì»¤ì„œ ìœ„ì¹˜, lastSeen       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### React Query í›… (`hooks/use-documents.ts`)

**Queries:**
- `useSearchDocs(query)` - ë¬¸ì„œ ê²€ìƒ‰
- `useSidebar(parentId?)` - ì‚¬ì´ë“œë°” íŠ¸ë¦¬ ë°ì´í„°
- `useTrash()` - íœ´ì§€í†µ ëª©ë¡
- `useDocument(id)` - ë‹¨ì¼ ë¬¸ì„œ ì¡°íšŒ
- `usePublicDocument(id)` - ê³µê°œ ë¬¸ì„œ ì¡°íšŒ

**Mutations:**
- `useCreateDocument()` - ë¬¸ì„œ ìƒì„± â†’ ìë™ìœ¼ë¡œ ì‚¬ì´ë“œë°” ìºì‹œ ë¬´íš¨í™”
- `useUpdateDocument()` - ë¬¸ì„œ ìˆ˜ì •
- `useArchiveDocument()` - ì•„ì¹´ì´ë¸Œ
- `useRestoreDocument()` - ë³µì›
- `useRemoveDocument()` - ì˜êµ¬ ì‚­ì œ
- `useRemoveIcon()` - ì•„ì´ì½˜ ì œê±°
- `useRemoveCoverImage()` - ì»¤ë²„ ì œê±°

### API í´ë¼ì´ì–¸íŠ¸ (`lib/api.ts`)

íƒ€ì… ì•ˆì „í•œ fetch ë˜í¼ë¡œ ëª¨ë“  API í˜¸ì¶œì„ ì¤‘ì•™ ê´€ë¦¬í•©ë‹ˆë‹¤:

```typescript
documentsApi.search(query)        // GET /api/documents?q=...
documentsApi.getSidebar(parentId)  // GET /api/documents/sidebar
documentsApi.getTrash()            // GET /api/documents/trash
documentsApi.getById(id)           // GET /api/documents/[id]
documentsApi.create(data)          // POST /api/documents
documentsApi.update(id, data)      // PATCH /api/documents/[id]
// ... ë“±
```

---

## ì‹¤ì‹œê°„ í˜‘ì—…

### ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     WebSocket      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     WebSocket     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client A  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Yjs WebSocket   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Client B  â”‚
â”‚            â”‚                    â”‚  Server (:1234)  â”‚                   â”‚            â”‚
â”‚  BlockNote â”‚   Yjs Updates      â”‚                  â”‚   Yjs Updates     â”‚  BlockNote â”‚
â”‚  + Yjs Doc â”‚   (CRDT Ops)       â”‚  Document Room   â”‚   (CRDT Ops)      â”‚  + Yjs Doc â”‚
â”‚            â”‚                    â”‚  Management      â”‚                   â”‚            â”‚
â”‚  Awareness â”‚   Presence Info    â”‚                  â”‚   Presence Info   â”‚  Awareness â”‚
â”‚  Provider  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Broadcast       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Provider  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë™ì‘ ë°©ì‹

1. **ë¬¸ì„œ ì—´ê¸°**: í´ë¼ì´ì–¸íŠ¸ê°€ ë¬¸ì„œ ID ê¸°ë°˜ "ë°©"ì— WebSocket ì ‘ì†
2. **CRDT ë™ê¸°í™”**: Yjsê°€ ì¶©ëŒ ì—†ëŠ” ë³µì œ ë°ì´í„° íƒ€ì…(CRDT)ìœ¼ë¡œ ë™ì‹œ í¸ì§‘ í•´ê²°
3. **Awareness**: ì ‘ì†ì ì •ë³´ (ì´ë¦„, ìƒ‰ìƒ, lastSeen)ë¥¼ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— ë¸Œë¡œë“œìºìŠ¤íŠ¸
4. **Persistence**: ë¬¸ì„œ ë‚´ìš©ì€ ë³„ë„ë¡œ APIë¥¼ í†µí•´ PostgreSQLì— ì €ì¥

### ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

ì—ë””í„° (`components/editor.tsx`)ì—ì„œ Yjs í”„ë¡œë°”ì´ë”ë¥¼ ìƒì„±í•˜ê³  BlockNoteì— ì—°ê²°:

- `WebsocketProvider`: Yjs WebSocket ì„œë²„ì— ì—°ê²°
- `awareness`: ì ‘ì†ì ìƒíƒœ ê³µìœ 
- BlockNote `collaboration` ì˜µì…˜ì— `fragment`ì™€ `provider` ì „ë‹¬

---

## ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜

### Provider ê³„ì¸µ

```
<html>
  <body>
    <ThemeProvider>              â† ë‹¤í¬/ë¼ì´íŠ¸ í…Œë§ˆ
      <QueryProvider>            â† React Query + NextAuth Session
        <Toaster />              â† í† ìŠ¤íŠ¸ ì•Œë¦¼
        <ModalProvider />        â† ì„¤ì •, ì»¤ë²„ ì´ë¯¸ì§€ ëª¨ë‹¬
        {children}               â† í˜ì´ì§€ ì½˜í…ì¸ 
      </QueryProvider>
    </ThemeProvider>
  </body>
</html>
```

### ì£¼ìš” í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸

#### ë¬¸ì„œ í¸ì§‘ í˜ì´ì§€ (`app/(main)/(routes)/documents/[documentId]/page.tsx`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Navigation (Sidebar)    â”‚  Navbar                â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â€¢ UserItem              â”‚  â”‚ Title  Collab  â‹® â”‚  â”‚
â”‚ â€¢ Search (âŒ˜+K)         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â€¢ Settings              â”‚                        â”‚
â”‚ â€¢ New Page (+)          â”‚  Cover Image           â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ Document Tree:          â”‚  â”‚ ğŸ–¼ï¸ Cover          â”‚  â”‚
â”‚ â”œâ”€â”€ Page 1              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”‚   â”œâ”€â”€ Sub Page A      â”‚                        â”‚
â”‚ â”‚   â””â”€â”€ Sub Page B      â”‚  Toolbar               â”‚
â”‚ â”œâ”€â”€ Page 2 â—„ active     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â””â”€â”€ Page 3              â”‚  â”‚ Icon  Title      â”‚  â”‚
â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ Trash                   â”‚                        â”‚
â”‚                         â”‚  Editor (BlockNote)    â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                         â”‚  â”‚ Rich text...     â”‚  â”‚
â”‚                         â”‚  â”‚ with real-time   â”‚  â”‚
â”‚                         â”‚  â”‚ collaboration    â”‚  â”‚
â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### UI ì»´í¬ë„ŒíŠ¸ (`components/ui/`)

shadcn/ui ê¸°ë°˜ Radix í”„ë¦¬ë¯¸í‹°ë¸Œ:

- `Button` - ë‹¤ì–‘í•œ variant (default, destructive, outline, ghost, link)
- `Dialog` - ëª¨ë‹¬ ë‹¤ì´ì–¼ë¡œê·¸
- `DropdownMenu` - ë“œë¡­ë‹¤ìš´ ë©”ë‰´
- `Popover` - íŒì˜¤ë²„ (ì´ëª¨ì§€ ì„ íƒê¸° ë“±)
- `Command` - ì»¤ë§¨ë“œ íŒ”ë ˆíŠ¸ (cmdk)
- `AlertDialog` - í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
- `Avatar` - ì‚¬ìš©ì ì•„ë°”íƒ€
- `Input`, `Label` - í¼ ìš”ì†Œ
- `Skeleton` - ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤

---

## ìŠ¤íƒ€ì¼ë§ ì‹œìŠ¤í…œ

### Seed Design System í† í°

Tailwind CSSë¥¼ í™•ì¥í•˜ì—¬ Seed Design System(ë‹¹ê·¼) ë””ìì¸ í† í°ì„ ì ìš©í•©ë‹ˆë‹¤.

#### ìƒ‰ìƒ (Color Tokens)

```css
/* ë¸Œëœë“œ ì»¬ëŸ¬ */
--seed-brand: hsl(24, 100%, 50%)        /* ì˜¤ë Œì§€ */
--seed-brand-hover: hsl(24, 100%, 45%)

/* ì‹œë§¨í‹± ì»¬ëŸ¬ */
--seed-informative: hsl(213, 97%, 56%)   /* ë¸”ë£¨ */
--seed-positive: hsl(145, 65%, 42%)      /* ê·¸ë¦° */
--seed-warning: hsl(24, 100%, 50%)       /* ì˜¤ë Œì§€ */

/* ë‹¤í¬ ëª¨ë“œì—ì„œëŠ” warm gray ê³„ì—´ë¡œ ì „í™˜ */
--background: 220 20% 10%
--foreground: 220 15% 95%
```

#### ë ˆì´ì•„ì›ƒ í† í°

```css
/* Border Radius */
--seed-r1: 4px   --seed-r2: 8px
--seed-r3: 12px  --seed-r4: 16px

/* Shadows */
--seed-s1: 0 1px 2px rgba(0,0,0,0.05)    /* ë¯¸ë¬˜ */
--seed-s2: 0 4px 6px rgba(0,0,0,0.07)    /* ê¸°ë³¸ */
--seed-s3: 0 10px 15px rgba(0,0,0,0.1)   /* ê°•ì¡° */
```

#### íƒ€ì´í¬ê·¸ë˜í”¼

```
Font Stack: Pretendard, Roboto, "Noto Sans KR", system-ui, sans-serif
```

### cn() ìœ í‹¸ë¦¬í‹°

`clsx` + `tailwind-merge`ë¥¼ ê²°í•©í•œ í´ë˜ìŠ¤ ë³‘í•© ìœ í‹¸ë¦¬í‹°:

```typescript
import { cn } from "@/lib/utils"

<div className={cn("base-class", conditional && "active-class", className)} />
```

---

## ë°°í¬ êµ¬ì„±

### Docker Compose ì„œë¹„ìŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Docker Compose Network              â”‚
â”‚              (sootion-net: bridge)                â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   postgres   â”‚  â”‚   yjs    â”‚  â”‚    app     â”‚ â”‚
â”‚  â”‚  :5432      â”‚  â”‚  :1234   â”‚  â”‚  :3000     â”‚ â”‚
â”‚  â”‚             â”‚  â”‚          â”‚  â”‚  (â†’ :3001) â”‚ â”‚
â”‚  â”‚ PG 16       â”‚  â”‚ y-ws     â”‚  â”‚ Next.js    â”‚ â”‚
â”‚  â”‚ Alpine      â”‚  â”‚ server   â”‚  â”‚ Standalone â”‚ â”‚
â”‚  â”‚             â”‚  â”‚          â”‚  â”‚            â”‚ â”‚
â”‚  â”‚ Volume:     â”‚  â”‚          â”‚  â”‚ Volume:    â”‚ â”‚
â”‚  â”‚  pgdata     â”‚  â”‚          â”‚  â”‚  uploads   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                             â”‚         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€ depends_on â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           (healthcheck: pg_isready)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì„œë¹„ìŠ¤ ì„¤ëª…

| ì„œë¹„ìŠ¤ | ì´ë¯¸ì§€ | í¬íŠ¸ | ë³¼ë¥¨ | ì„¤ëª… |
|--------|-------|------|------|------|
| `postgres` | postgres:16-alpine | 5432 (ë‚´ë¶€) | pgdata | ë©”ì¸ ë°ì´í„°ë² ì´ìŠ¤ |
| `yjs` | ì»¤ìŠ¤í…€ (Dockerfile.yjs) | 1234 | - | ì‹¤ì‹œê°„ í˜‘ì—… WebSocket |
| `app` | ì»¤ìŠ¤í…€ (Dockerfile) | 3001â†’3000 | uploads | Next.js ì•± |

### í™˜ê²½ ë³€ìˆ˜

```bash
# ë°ì´í„°ë² ì´ìŠ¤
DATABASE_URL=postgresql://user:pass@postgres:5432/sootion

# ì¸ì¦
AUTH_SECRET=<random-secret>           # JWT ì„œëª… í‚¤
AUTH_OKTA_ID=<okta-client-id>         # (ì„ íƒ) Okta OAuth
AUTH_OKTA_SECRET=<okta-client-secret> # (ì„ íƒ) Okta OAuth
AUTH_OKTA_ISSUER=<okta-issuer-url>    # (ì„ íƒ) Okta OAuth

# ì‹¤ì‹œê°„ í˜‘ì—…
NEXT_PUBLIC_YJS_WS_URL=               # ë¹„ì–´ìˆìœ¼ë©´ ìë™ ê°ì§€
```

### ì‹¤í–‰

```bash
# 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cp .env.example .env
# .env íŒŒì¼ì„ í¸ì§‘í•˜ì—¬ AUTH_SECRET ë“± ê°’ì„ ì„¤ì •

# 2. ì „ì²´ ìŠ¤íƒ ì‹¤í–‰ (postgres + yjs + app)
docker compose up -d

# 3. ìµœì´ˆ ì‹¤í–‰ ì‹œ DB ë§ˆì´ê·¸ë ˆì´ì…˜
docker compose exec app node scripts/migrate.mjs

# ë¹Œë“œ í™•ì¸
docker compose logs -f app
```

> **ì°¸ê³ **: ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ìµœì´ˆ 1íšŒë§Œ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤. `CREATE TABLE IF NOT EXISTS`ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì¤‘ë³µ ì‹¤í–‰í•´ë„ ì•ˆì „í•©ë‹ˆë‹¤.

---

## ë¶€ë¡: ì£¼ìš” ì˜ì¡´ì„± ëª©ë¡

| íŒ¨í‚¤ì§€ | ìš©ë„ |
|--------|------|
| `@blocknote/core`, `react`, `shadcn` | ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„° |
| `@radix-ui/*` | ì ‘ê·¼ì„± UI í”„ë¦¬ë¯¸í‹°ë¸Œ |
| `@tanstack/react-query` | ì„œë²„ ìƒíƒœ ê´€ë¦¬ |
| `bcryptjs` | ë¹„ë°€ë²ˆí˜¸ í•´ì‹± |
| `class-variance-authority` | ì»´í¬ë„ŒíŠ¸ variant ê´€ë¦¬ |
| `cmdk` | ì»¤ë§¨ë“œ íŒ”ë ˆíŠ¸ |
| `drizzle-orm` + `pg` | PostgreSQL ORM |
| `emoji-picker-react` | ì´ëª¨ì§€ ì„ íƒê¸° |
| `lucide-react` | ì•„ì´ì½˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ |
| `next-auth` | ì¸ì¦ (JWT + OAuth) |
| `next-themes` | í…Œë§ˆ ì „í™˜ |
| `react-dropzone` | íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­ |
| `react-textarea-autosize` | ìë™ ë†’ì´ ì¡°ì ˆ í…ìŠ¤íŠ¸ì˜ì—­ |
| `sonner` | í† ìŠ¤íŠ¸ ì•Œë¦¼ |
| `y-websocket` + `yjs` | ì‹¤ì‹œê°„ CRDT ë™ê¸°í™” |
| `zod` | ëŸ°íƒ€ì„ ìŠ¤í‚¤ë§ˆ ê²€ì¦ |
| `zustand` | í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê´€ë¦¬ |
